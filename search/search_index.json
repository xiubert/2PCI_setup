{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Sutter 2P Rig Documentation Welcome to the documentation for the Sutter 2P rig for in vivo 2-photon calcium imaging (2PCI). Overview This documentation covers the setup, configuration, and operation of the Sutter 2P microscopy system, including: Hardware : Sutter MOM microscope, DAQs, and peripheral equipment Software : Ephus and ScanImage configuration Alignment : Laser alignment procedures and best practices Calibration : Laser power and speaker calibration protocols Operation : Daily workflows and troubleshooting Quick Links Setup & Configuration Hardware - Equipment specifications and connections Software - Software installation and setup Configuration - Ephus and ScanImage configuration files Computer Setup - Computer and driver installation Drivers - Required drivers and installation Operation Alignment - Laser alignment procedures Laser Power Calibration - Calibrating laser power Speaker Calibration - Calibrating audio stimulation Pupillometry - Pupil tracking setup Development Code - Custom scripts and functions Getting Started Review the Hardware documentation to understand the system components Follow the Alignment guide to align the 2P laser Check the Configuration for Ephus and ScanImage settings Refer to calibration procedures before each experiment Support Primary Contact : Rick Ayer (Sutter Instruments) Email: rick@sutter.com Resources Sutter MOM Microscope Alignment Tutorial Video","title":"Home"},{"location":"#sutter-2p-rig-documentation","text":"Welcome to the documentation for the Sutter 2P rig for in vivo 2-photon calcium imaging (2PCI).","title":"Sutter 2P Rig Documentation"},{"location":"#overview","text":"This documentation covers the setup, configuration, and operation of the Sutter 2P microscopy system, including: Hardware : Sutter MOM microscope, DAQs, and peripheral equipment Software : Ephus and ScanImage configuration Alignment : Laser alignment procedures and best practices Calibration : Laser power and speaker calibration protocols Operation : Daily workflows and troubleshooting","title":"Overview"},{"location":"#quick-links","text":"","title":"Quick Links"},{"location":"#setup-configuration","text":"Hardware - Equipment specifications and connections Software - Software installation and setup Configuration - Ephus and ScanImage configuration files Computer Setup - Computer and driver installation Drivers - Required drivers and installation","title":"Setup &amp; Configuration"},{"location":"#operation","text":"Alignment - Laser alignment procedures Laser Power Calibration - Calibrating laser power Speaker Calibration - Calibrating audio stimulation Pupillometry - Pupil tracking setup","title":"Operation"},{"location":"#development","text":"Code - Custom scripts and functions","title":"Development"},{"location":"#getting-started","text":"Review the Hardware documentation to understand the system components Follow the Alignment guide to align the 2P laser Check the Configuration for Ephus and ScanImage settings Refer to calibration procedures before each experiment","title":"Getting Started"},{"location":"#support","text":"Primary Contact : Rick Ayer (Sutter Instruments) Email: rick@sutter.com","title":"Support"},{"location":"#resources","text":"Sutter MOM Microscope Alignment Tutorial Video","title":"Resources"},{"location":"about/","text":"About This Documentation Purpose This documentation provides comprehensive information for operating and maintaining the Sutter 2P microscopy system for in vivo 2-photon calcium imaging (2PCI). It serves as a reference for: System setup and configuration Daily operation procedures Troubleshooting and maintenance Custom software configurations System Overview Hardware The rig is built around a Sutter MOM (Moveable Objective Microscope) , which features a moveable objective rather than a moveable stage (unlike the Scientifica rig configuration). Key Components: Sutter MOM microscope Sutter ROE-200 micromanipulator Two National Instruments DAQ boards: NI USB-6299 (Dev2) - Ephus acquire/sound stimulation NI PCI-6110 with BNC-2090A breakout (Dev1) - ScanImage 2P Hamamatsu PMT (H10770PA-40) 2-photon laser system Software Stack Ephus : Data acquisition and stimulus delivery ScanImage : 2-photon microscopy control MATLAB : Runtime environment for both systems Custom user functions : Automated workflows and experiment control Documentation Structure This documentation is organized into several key sections: Setup Documentation Hardware : Detailed specifications and wiring diagrams Software : Software requirements and installation Drivers : Required drivers and compatibility information Computer Setup : System configuration and optimization Configuration Configuration : Ephus and ScanImage configuration files with detailed parameter explanations Operational Procedures Alignment : Step-by-step laser alignment procedures with safety protocols Calibration Procedures : Laser power and speaker calibration Pupillometry : Pupil tracking configuration Development Code : Custom MATLAB functions and user scripts Key Features Synchronized Acquisition The system uses two DAQ boards synchronized via: Trigger routing: Dev2 \u2192 Dev1 via PFI connections Sample clock sharing for precise temporal coordination Custom user functions for automated experiment control Custom User Functions The documentation includes several custom MATLAB functions for: Saving stimulus pulse details Random pulse selection (with/without replacement) Camera reset automation Pulse train generation Safety Protocols Comprehensive safety information including: Laser safety glasses specifications (LG8 for 690nm, LG9 for 920nm) Alignment procedures with proper protective equipment Power monitoring and control Maintenance & Support Primary Technical Contact: Rick Ayer, Sutter Instruments Email: rick@sutter.com Known Issues Herringbone artifact : Normal for End-On Hamamatsu PMT configuration See individual documentation pages for specific troubleshooting Contributing This documentation is maintained as a living document. Updates should include: Configuration file changes with date stamps New procedures or workflow improvements Troubleshooting solutions for common issues Hardware or software modifications Version History Last updated: December 9, 2025 Major configuration files: Ephus init: ephus_init_matlab2013b_32bit_250kHz_Camera_20250903.m ScanImage configs: 256pxSq_5Hz_acqModeArmed.cfg , 256pxSq_5Hz_merge_acqModeArmed.cfg","title":"About"},{"location":"about/#about-this-documentation","text":"","title":"About This Documentation"},{"location":"about/#purpose","text":"This documentation provides comprehensive information for operating and maintaining the Sutter 2P microscopy system for in vivo 2-photon calcium imaging (2PCI). It serves as a reference for: System setup and configuration Daily operation procedures Troubleshooting and maintenance Custom software configurations","title":"Purpose"},{"location":"about/#system-overview","text":"","title":"System Overview"},{"location":"about/#hardware","text":"The rig is built around a Sutter MOM (Moveable Objective Microscope) , which features a moveable objective rather than a moveable stage (unlike the Scientifica rig configuration). Key Components: Sutter MOM microscope Sutter ROE-200 micromanipulator Two National Instruments DAQ boards: NI USB-6299 (Dev2) - Ephus acquire/sound stimulation NI PCI-6110 with BNC-2090A breakout (Dev1) - ScanImage 2P Hamamatsu PMT (H10770PA-40) 2-photon laser system","title":"Hardware"},{"location":"about/#software-stack","text":"Ephus : Data acquisition and stimulus delivery ScanImage : 2-photon microscopy control MATLAB : Runtime environment for both systems Custom user functions : Automated workflows and experiment control","title":"Software Stack"},{"location":"about/#documentation-structure","text":"This documentation is organized into several key sections:","title":"Documentation Structure"},{"location":"about/#setup-documentation","text":"Hardware : Detailed specifications and wiring diagrams Software : Software requirements and installation Drivers : Required drivers and compatibility information Computer Setup : System configuration and optimization","title":"Setup Documentation"},{"location":"about/#configuration","text":"Configuration : Ephus and ScanImage configuration files with detailed parameter explanations","title":"Configuration"},{"location":"about/#operational-procedures","text":"Alignment : Step-by-step laser alignment procedures with safety protocols Calibration Procedures : Laser power and speaker calibration Pupillometry : Pupil tracking configuration","title":"Operational Procedures"},{"location":"about/#development","text":"Code : Custom MATLAB functions and user scripts","title":"Development"},{"location":"about/#key-features","text":"","title":"Key Features"},{"location":"about/#synchronized-acquisition","text":"The system uses two DAQ boards synchronized via: Trigger routing: Dev2 \u2192 Dev1 via PFI connections Sample clock sharing for precise temporal coordination Custom user functions for automated experiment control","title":"Synchronized Acquisition"},{"location":"about/#custom-user-functions","text":"The documentation includes several custom MATLAB functions for: Saving stimulus pulse details Random pulse selection (with/without replacement) Camera reset automation Pulse train generation","title":"Custom User Functions"},{"location":"about/#safety-protocols","text":"Comprehensive safety information including: Laser safety glasses specifications (LG8 for 690nm, LG9 for 920nm) Alignment procedures with proper protective equipment Power monitoring and control","title":"Safety Protocols"},{"location":"about/#maintenance-support","text":"Primary Technical Contact: Rick Ayer, Sutter Instruments Email: rick@sutter.com","title":"Maintenance &amp; Support"},{"location":"about/#known-issues","text":"Herringbone artifact : Normal for End-On Hamamatsu PMT configuration See individual documentation pages for specific troubleshooting","title":"Known Issues"},{"location":"about/#contributing","text":"This documentation is maintained as a living document. Updates should include: Configuration file changes with date stamps New procedures or workflow improvements Troubleshooting solutions for common issues Hardware or software modifications","title":"Contributing"},{"location":"about/#version-history","text":"Last updated: December 9, 2025 Major configuration files: Ephus init: ephus_init_matlab2013b_32bit_250kHz_Camera_20250903.m ScanImage configs: 256pxSq_5Hz_acqModeArmed.cfg , 256pxSq_5Hz_merge_acqModeArmed.cfg","title":"Version History"},{"location":"alignment/","text":"Aligning 2P laser to Sutter 2P rig Best person to contact: Rick Ayer of Sutter Instruments: rick@sutter.com Herringbone artifact normal for End-On Hammamatsu PMT H10770PA-40 References Sutter 2P Alignment Tutorial Video Safety Safety glasses (Thorlabs) For 2P laser alignment at 690nm: LG8 (green lens): LG8 series does NOT cover 920nm Wavelength coverage: Only 630-695nm (stops at 695nm) Does not provide protection at 920nm \u274c Higher OD (5+ vs 3+) provides better protection during alignment Still has reasonable VLT (24%) for seeing your alignment The slightly reduced visibility compared to LG9 is worth the extra 2 OD levels of protection For 2P laser alignment at 920nm: LG9 (orange lens): Wavelength coverage: 610-695nm AND >740-1070nm (covers 920nm) Optical Density (OD): 7+ at 920nm Visible Light Transmission (VLT): 44% EN 207 Rating: D LB6 + IRM LB7 in the >740-1070nm range LG8 series does NOT cover 920nm Coarse Alignment Process Prerequisites: Wear LG8 safety glasses during alignment Ensure bolts to table are secure Steps Set laser wavelength to 920nm Adjust Optic Rotation Mount (Newport RSP-1T) so that power meters for both Scientifica and Sutter read about 50% (even split between 2 rigs) Slightly loosen post bolt of barrel at first split and twist such that both meters are at max for 50% split Tighten down barrel post bolt Ensure beam passes uninterrupted through shutter to 90deg mirrors Adjusting 90deg mirrors: ignore the screw on the corner (middle screw at 90deg angle) Top screw: up / down Bottom screw: left / right Key Points Last stage at which beam is focal dot : The horizontal enclosure (not the one labeled MOM) before the galvos (see tutorial video ) \u2014 beam expands after that After laser reaches objective : For further alignment, adjust mirror closer to the laser (further from objective) for more angular movement Fine Alignment Using Pollen Grains Initial Setup Select a spikey pollen grain at 40X (via pollen grain slide) as your alignment target Navigate to the top surface of the pollen grain Enable the crosshair (right-click on image) Display the histogram Histogram Settings Left edge of histogram bar : Position at peak (should be near zero) Right edge : Balance for good background noise contrast Alignment Check Focus through the pollen grain from top to bottom Monitor whether the pollen grain remains centered on the crosshair If centered throughout : Laser is properly aligned \u2713 If drifts off center : Adjustment needed \u2192 Use the mirror closest to the laser Beam Walking (if intensity drops) If you experience intensity loss, \"walk the beam\" back: - Adjust one direction on the first mirror - Compensate in the opposite direction on the second mirror - Example: Right on first mirror \u2192 Left on second mirror - This keeps the beam parallel while translating it laterally Why walk the beam? - Adjusting only one mirror changes the beam angle - Adjusting both mirrors together translates the beam position without changing angle - Proper alignment ensures the beam only moves in Z (focus) , not X-Y, when focusing Goal The beam should remain stationary in X-Y position while scanning through the Z-axis (focus). Log 12/9/2025","title":"2P Laser Alignment"},{"location":"alignment/#aligning-2p-laser-to-sutter-2p-rig","text":"Best person to contact: Rick Ayer of Sutter Instruments: rick@sutter.com Herringbone artifact normal for End-On Hammamatsu PMT H10770PA-40","title":"Aligning 2P laser to Sutter 2P rig"},{"location":"alignment/#references","text":"Sutter 2P Alignment Tutorial Video","title":"References"},{"location":"alignment/#safety","text":"Safety glasses (Thorlabs) For 2P laser alignment at 690nm: LG8 (green lens): LG8 series does NOT cover 920nm Wavelength coverage: Only 630-695nm (stops at 695nm) Does not provide protection at 920nm \u274c Higher OD (5+ vs 3+) provides better protection during alignment Still has reasonable VLT (24%) for seeing your alignment The slightly reduced visibility compared to LG9 is worth the extra 2 OD levels of protection For 2P laser alignment at 920nm: LG9 (orange lens): Wavelength coverage: 610-695nm AND >740-1070nm (covers 920nm) Optical Density (OD): 7+ at 920nm Visible Light Transmission (VLT): 44% EN 207 Rating: D LB6 + IRM LB7 in the >740-1070nm range LG8 series does NOT cover 920nm","title":"Safety"},{"location":"alignment/#coarse-alignment-process","text":"","title":"Coarse Alignment Process"},{"location":"alignment/#prerequisites","text":"Wear LG8 safety glasses during alignment Ensure bolts to table are secure","title":"Prerequisites:"},{"location":"alignment/#steps","text":"Set laser wavelength to 920nm Adjust Optic Rotation Mount (Newport RSP-1T) so that power meters for both Scientifica and Sutter read about 50% (even split between 2 rigs) Slightly loosen post bolt of barrel at first split and twist such that both meters are at max for 50% split Tighten down barrel post bolt Ensure beam passes uninterrupted through shutter to 90deg mirrors Adjusting 90deg mirrors: ignore the screw on the corner (middle screw at 90deg angle) Top screw: up / down Bottom screw: left / right","title":"Steps"},{"location":"alignment/#key-points","text":"Last stage at which beam is focal dot : The horizontal enclosure (not the one labeled MOM) before the galvos (see tutorial video ) \u2014 beam expands after that After laser reaches objective : For further alignment, adjust mirror closer to the laser (further from objective) for more angular movement","title":"Key Points"},{"location":"alignment/#fine-alignment-using-pollen-grains","text":"","title":"Fine Alignment Using Pollen Grains"},{"location":"alignment/#initial-setup","text":"Select a spikey pollen grain at 40X (via pollen grain slide) as your alignment target Navigate to the top surface of the pollen grain Enable the crosshair (right-click on image) Display the histogram","title":"Initial Setup"},{"location":"alignment/#histogram-settings","text":"Left edge of histogram bar : Position at peak (should be near zero) Right edge : Balance for good background noise contrast","title":"Histogram Settings"},{"location":"alignment/#alignment-check","text":"Focus through the pollen grain from top to bottom Monitor whether the pollen grain remains centered on the crosshair If centered throughout : Laser is properly aligned \u2713 If drifts off center : Adjustment needed \u2192 Use the mirror closest to the laser","title":"Alignment Check"},{"location":"alignment/#beam-walking-if-intensity-drops","text":"If you experience intensity loss, \"walk the beam\" back: - Adjust one direction on the first mirror - Compensate in the opposite direction on the second mirror - Example: Right on first mirror \u2192 Left on second mirror - This keeps the beam parallel while translating it laterally Why walk the beam? - Adjusting only one mirror changes the beam angle - Adjusting both mirrors together translates the beam position without changing angle - Proper alignment ensures the beam only moves in Z (focus) , not X-Y, when focusing","title":"Beam Walking (if intensity drops)"},{"location":"alignment/#goal","text":"The beam should remain stationary in X-Y position while scanning through the Z-axis (focus).","title":"Goal"},{"location":"alignment/#log","text":"12/9/2025","title":"Log"},{"location":"cal_laser_power/","text":"","title":"2P Laser Power calibration"},{"location":"cal_speaker/","text":"Speaker calibration Instructions for calibrating rig speaker Purpose : Speaker has nonlinear response across frequencies, must ensure voltage delivered to speaker corresponds to desired dB output for various signals Output : gain values corresponding to voltage needed to drive speaker to obtain desired dB SPL Tools Oscilloscope: Tektronix TDS2002B microphone with attached pre-amp (1/8 inch 4138-A-015; Br\u00fcel and Kj\u00e6r / HBK) reference sound calibrator (Type 4231, Br\u00fcel and Kj\u00e6r / HBK) amp (Nexus 2690-0S Br\u00fcel and Kj\u00e6r / HBK) Br\u00fcel and Kj\u00e6r / HBK tool contact: Isaac.farzaneh@hbkworld.com | 800-332-2040 Prerequisite: calibration stimuli Generate stimuli in MATLAB. See: stimuli generation code 1. Amp setup Setup Menu: Amplifier Set-up: Output sensitivity from Nexus amp Can set the output to 3.16 V/Pa as shown below. Make sure the band-pass filter is configured correctly so the system can read the 1000 Hz tone from the 4231 calibrator. Setting the filter to 0.1\u2013100 kHz allows the full usable frequency range to pass through. 1 Pa corresponds to 94 dB Transducer Set-up: Microphone sensitivity The nominal sensitivity of the 4939-A-011 is 4 mV/Pa, but if you have a calibration card for your specific microphone (inside microphone box), you should enter the actual calibrated sensitivity shown on the card. Transducer Supply: Microphone sensitivity Set the polarization voltage to 200 V. The 4939-A-011 is an externally polarized microphone, so it requires a 200 V polarization supply. 3. Record 94 dB reference voltage 1 Pa corresponds to 94 dB. Type 4231 reference speaker outputs 1 kHz at 94 dB. Thus, if output sensitivity set to 3.16 V / Pa, should see 3.16 V RMS on oscilloscope with 'Autoset' 4. Record stimuli voltage Set gain to 1500 and record voltage for stimuli that are to be calibrated Can use scripts pure tones and all other stimuli (BPN etc) Reference see: sound level equations Volt2dB dB = 20 \u00b7 log\u2081\u2080(V_out/V_ref) + dB_ref dBwant2voltage dB = 20 \u00b7 log\u2081\u2080(V_want/V_ref) + dB_ref [ ] = (dB - dB_ref)/20 10^[(dB - dB_ref)/20] V_want/V_ref = 10^((dB - dB_ref)/20) V_want = 10^((dB - dB_ref)/20) \u00b7 V_ref Vwant2gain V_Gref/G_ref = V_want/G_set G_set = G_ref \u00b7 (V_want/V_Gref)","title":"Speaker calibration"},{"location":"cal_speaker/#speaker-calibration","text":"Instructions for calibrating rig speaker Purpose : Speaker has nonlinear response across frequencies, must ensure voltage delivered to speaker corresponds to desired dB output for various signals Output : gain values corresponding to voltage needed to drive speaker to obtain desired dB SPL","title":"Speaker calibration"},{"location":"cal_speaker/#tools","text":"Oscilloscope: Tektronix TDS2002B microphone with attached pre-amp (1/8 inch 4138-A-015; Br\u00fcel and Kj\u00e6r / HBK) reference sound calibrator (Type 4231, Br\u00fcel and Kj\u00e6r / HBK) amp (Nexus 2690-0S Br\u00fcel and Kj\u00e6r / HBK) Br\u00fcel and Kj\u00e6r / HBK tool contact: Isaac.farzaneh@hbkworld.com | 800-332-2040","title":"Tools"},{"location":"cal_speaker/#prerequisite-calibration-stimuli","text":"Generate stimuli in MATLAB. See: stimuli generation code","title":"Prerequisite: calibration stimuli"},{"location":"cal_speaker/#1-amp-setup","text":"Setup Menu: Amplifier Set-up: Output sensitivity from Nexus amp Can set the output to 3.16 V/Pa as shown below. Make sure the band-pass filter is configured correctly so the system can read the 1000 Hz tone from the 4231 calibrator. Setting the filter to 0.1\u2013100 kHz allows the full usable frequency range to pass through. 1 Pa corresponds to 94 dB Transducer Set-up: Microphone sensitivity The nominal sensitivity of the 4939-A-011 is 4 mV/Pa, but if you have a calibration card for your specific microphone (inside microphone box), you should enter the actual calibrated sensitivity shown on the card. Transducer Supply: Microphone sensitivity Set the polarization voltage to 200 V. The 4939-A-011 is an externally polarized microphone, so it requires a 200 V polarization supply.","title":"1. Amp setup"},{"location":"cal_speaker/#3-record-94-db-reference-voltage","text":"1 Pa corresponds to 94 dB. Type 4231 reference speaker outputs 1 kHz at 94 dB. Thus, if output sensitivity set to 3.16 V / Pa, should see 3.16 V RMS on oscilloscope with 'Autoset'","title":"3. Record 94 dB reference voltage"},{"location":"cal_speaker/#4-record-stimuli-voltage","text":"Set gain to 1500 and record voltage for stimuli that are to be calibrated Can use scripts pure tones and all other stimuli (BPN etc)","title":"4. Record stimuli voltage"},{"location":"cal_speaker/#reference","text":"see: sound level equations","title":"Reference"},{"location":"cal_speaker/#volt2db","text":"dB = 20 \u00b7 log\u2081\u2080(V_out/V_ref) + dB_ref","title":"Volt2dB"},{"location":"cal_speaker/#dbwant2voltage","text":"dB = 20 \u00b7 log\u2081\u2080(V_want/V_ref) + dB_ref [ ] = (dB - dB_ref)/20 10^[(dB - dB_ref)/20] V_want/V_ref = 10^((dB - dB_ref)/20) V_want = 10^((dB - dB_ref)/20) \u00b7 V_ref","title":"dBwant2voltage"},{"location":"cal_speaker/#vwant2gain","text":"V_Gref/G_ref = V_want/G_set G_set = G_ref \u00b7 (V_want/V_Gref)","title":"Vwant2gain"},{"location":"code/","text":"Code Code for data acquisition and analysis Data processing, stimulus generation, and calibration matlabPAC_general DRC stimuli (CGC_DRC) 2P data analysis matlabPAC_process2P neuropil decontamination (fissa_env_legacy) Widefield analysis pyFluo ScanImage user function User function Ephus user functions Custom user functions Data standardization 2P to NWB (data2nwb) Example DANDIset dataset with pupillometry Misc: ICEphys / ABF to NWB icephys_abf2nwb","title":"Code"},{"location":"code/#code","text":"Code for data acquisition and analysis","title":"Code"},{"location":"code/#data-processing-stimulus-generation-and-calibration","text":"matlabPAC_general DRC stimuli (CGC_DRC)","title":"Data processing, stimulus generation, and calibration"},{"location":"code/#2p-data-analysis","text":"matlabPAC_process2P neuropil decontamination (fissa_env_legacy)","title":"2P data analysis"},{"location":"code/#widefield-analysis","text":"pyFluo","title":"Widefield analysis"},{"location":"code/#scanimage-user-function","text":"User function","title":"ScanImage user function"},{"location":"code/#ephus-user-functions","text":"Custom user functions","title":"Ephus user functions"},{"location":"code/#data-standardization","text":"2P to NWB (data2nwb) Example DANDIset dataset with pupillometry","title":"Data standardization"},{"location":"code/#misc-icephys-abf-to-nwb","text":"icephys_abf2nwb","title":"Misc: ICEphys / ABF to NWB"},{"location":"computer_setup/","text":"Computer Setup Guide Initial setup instructions for the Dell Precision Tower 5810 acquisition computer. Prerequisites Disconnect USB DAQ - Ensure the USB DAQ is not connected before beginning installation Network & System Drivers Install GlobalProtect - Required for internet access Install Dell Support Assist - Automated driver installation tool See: drivers.md for driver details Disable Sleep/Hibernate - Prevent interruptions during data acquisition Go to Power Options and disable sleep and hibernate modes Hardware Drivers Install Audio Driver Audio_Driver_DDG39_WN32_6.0.1.6111_A06_01.EXE Install Chipset Drivers Chipset_Driver_8W65V_1.0.0.1024_A00_ZPE.exe Chipset_Driver_YV36W_WN32_10.1.2.10_A01.EXE Install Dell Security Advisory Update Dell-Security-Advisory-Update-DSA-2020-059_1GWG9_WIN64_1.0.0.0_A00_03.EXE Data Acquisition Drivers Install NI-DAQmx v15.5.0 NIDAQ1550f1.zip See: NI-DAQmx downloads Install Sutter CDM Controller Driver SI_CDM_v2_12_36.zip See: Installation guide Install Thorlabs Kinesis Driver - For laser power control Thorlabs_Kinesis_Setup_25822_x64.exe System Optimization Remove Unnecessary Programs Uninstall OneDrive and other unnecessary programs Disable Transparency Effects System Properties \u2192 Performance Settings \u2192 Disable transparency Software Installation Install MATLAB 2013b (32-bit) Install Ephus Copy Ephus 2013b_20250909_qcamFix.zip from Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC ) to C:/Rig/ Unzip Ephus 2013b_20250909_qcamFix.zip Ephus should be in folder named C:/Rig/Ephus 2013b Add C:/Rig/Ephus 2013b to MATLAB 2013b path with subfolders Install QCam Driver (v2.0.13.1 64-bit) QCamInstaller-2-0-13-1-64bit.zip see: Sharepoint: Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC \u2192 drivers Compatibility mode installation: Right-click the installer Select \"Troubleshoot compatibility\" Choose \"Custom\" Select \"Worked with previous version\" Choose \"Windows 7\" Continue with installation Testing: Turn on camera board Launch Ephus Add Ephus to MATLAB path Run startQCam to verify installation Install MATLAB 2015b x64 Install ScanImage Copy Scanimage5-3_20250905.zip from Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC ) to C:/Rig/ Unzip Scanimage5-3_20250905.zip ScanImage should be in folder named C:/Rig/Scanimage5-3 Add C:/Rig/Scanimage5-3 to MATLAB 2015b path with subfolders Configure Ephus and Scanimage see: Configuration","title":"Rig Setup"},{"location":"computer_setup/#computer-setup-guide","text":"Initial setup instructions for the Dell Precision Tower 5810 acquisition computer.","title":"Computer Setup Guide"},{"location":"computer_setup/#prerequisites","text":"Disconnect USB DAQ - Ensure the USB DAQ is not connected before beginning installation","title":"Prerequisites"},{"location":"computer_setup/#network-system-drivers","text":"Install GlobalProtect - Required for internet access Install Dell Support Assist - Automated driver installation tool See: drivers.md for driver details Disable Sleep/Hibernate - Prevent interruptions during data acquisition Go to Power Options and disable sleep and hibernate modes","title":"Network &amp; System Drivers"},{"location":"computer_setup/#hardware-drivers","text":"Install Audio Driver Audio_Driver_DDG39_WN32_6.0.1.6111_A06_01.EXE Install Chipset Drivers Chipset_Driver_8W65V_1.0.0.1024_A00_ZPE.exe Chipset_Driver_YV36W_WN32_10.1.2.10_A01.EXE Install Dell Security Advisory Update Dell-Security-Advisory-Update-DSA-2020-059_1GWG9_WIN64_1.0.0.0_A00_03.EXE","title":"Hardware Drivers"},{"location":"computer_setup/#data-acquisition-drivers","text":"Install NI-DAQmx v15.5.0 NIDAQ1550f1.zip See: NI-DAQmx downloads Install Sutter CDM Controller Driver SI_CDM_v2_12_36.zip See: Installation guide Install Thorlabs Kinesis Driver - For laser power control Thorlabs_Kinesis_Setup_25822_x64.exe","title":"Data Acquisition Drivers"},{"location":"computer_setup/#system-optimization","text":"Remove Unnecessary Programs Uninstall OneDrive and other unnecessary programs Disable Transparency Effects System Properties \u2192 Performance Settings \u2192 Disable transparency","title":"System Optimization"},{"location":"computer_setup/#software-installation","text":"Install MATLAB 2013b (32-bit) Install Ephus Copy Ephus 2013b_20250909_qcamFix.zip from Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC ) to C:/Rig/ Unzip Ephus 2013b_20250909_qcamFix.zip Ephus should be in folder named C:/Rig/Ephus 2013b Add C:/Rig/Ephus 2013b to MATLAB 2013b path with subfolders Install QCam Driver (v2.0.13.1 64-bit) QCamInstaller-2-0-13-1-64bit.zip see: Sharepoint: Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC \u2192 drivers Compatibility mode installation: Right-click the installer Select \"Troubleshoot compatibility\" Choose \"Custom\" Select \"Worked with previous version\" Choose \"Windows 7\" Continue with installation Testing: Turn on camera board Launch Ephus Add Ephus to MATLAB path Run startQCam to verify installation Install MATLAB 2015b x64 Install ScanImage Copy Scanimage5-3_20250905.zip from Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC ) to C:/Rig/ Unzip Scanimage5-3_20250905.zip ScanImage should be in folder named C:/Rig/Scanimage5-3 Add C:/Rig/Scanimage5-3 to MATLAB 2015b path with subfolders Configure Ephus and Scanimage see: Configuration","title":"Software Installation"},{"location":"configuration/","text":"Configuration Ephus Startup file ephus_init_matlab2013b_32bit_250kHz_Camera_20250903.m Key configuration values : xsgStartDirectory = 'D:\\Data\\sutter2P\\'; %Acquirer channels (Analog Input) acqChannelNames = {'sound output check', 'Green LED output check'}; % Cell array of descriptive names for analog input acquisition channels to configure, e.g. {'Lick Sensor' 'Nose Poke Sensor'}, acqBoardIDs = [2 2]; % A single number (e.g. 1 for 'Dev1') specifying DAQmx board for /all/ named acquisition channels; or, an array of numbers of length equal to 'acqChannelNames' (e.g. [1 1 1 2 2] indicating 'Dev1' for first 3 channels, 'Dev2' for last 2 channels) identifying DAQmx board on which each of the named acquisition channels appears. acqChannelIDs = [16 17]; % Array of numbers, of length equal to 'acqChannelNames', identifying DAQmx channel number (e.g. 1 for AI1) for each of the named acquisition channels (e.g. [0 1 2 0 1] indicating AI0-2 for first 3 channels and AI0-1 for last 2 channels, for case of multiple boards). %Stimulator channels (Analog Output) stimChannelNames = {'Sound output', 'Blue LED output', 'Camera trigger', 'Green LED output'}; % Cell array of descriptive names for analog output stimulus channels to configure, e.g. {'Whisker Stimulator' 'Position Encoder'}, stimBoardIDs = [2 2 2 2]; % A single number (e.g. 1 for 'Dev1') specifying DAQmx board for /all/ named analog stimulus channels; or, an array of numbers of length equal to 'stimChannelNames' (e.g. [1 1 1 2 2] indicating 'Dev1' for first 3 channels, 'Dev2' for last 2 channels) identifying DAQmx board on which each of the named analog stimulus channels appears. stimChannelIDs = [1 2 3 0]; % Array of numbers, of length equal to 'stimChannelNames', identifying DAQmx channel number (e.g. 1 for AI1) for each of the named analog stimulus channels (e.g. [0 1 2 0 1] indicating AI0-2 for first 3 channels and AI0-1 for last 2 channels, for case of multiple boards). initialSampleRate = 250000; %(REQUIRED) Initial rate, in Hz, to use for all analog and digital input/output channels configured for use in Ephus triggerOrigin = '/dev2/port0/line2'; %(REQUIRED) Full DAQmx specification of single digital line on /one/ board (e.g. '/dev1/port0/line0') used as the Ephus default trigger pulse to synchronize the one or more boards. triggerDestinations = {'PFI9','PFI0'}; %PFIO is external trigger-CTA %(REQUIRED) Cell array of one or more DAQmx PFI terminal names configured as the choice of PFI terminals on which Ephus must receive a trigger input signal, on /all/ of the DAQmx boards configured for use by Ephus. sampleClockOrigin = '/dev2/ctr0'; %this is ctr0 is PFI12, ctr1 is PFI13 CTA % Full DAQmx specification of single counter output channel on /one/ board (e.g. '/dev1/ctr0') on which the sample clock generated by Ephus appears. Ephus employs the default DAQmx routing of counter output channels to PFI output terminals (PFI12 for CTR0, PFI13 for CTR1; refer to DAQmx documentation for further information), Full DAQmx specification of counter output channel on /one/ board (e.g. '/dev1/ctr0') on which the sample clock is generated. sampleClockDestination = 'PFI10'; % A DAQmx PFI terminal name (e.g. 'PFI1') on which sample clock is input on /all/ of the boards used by Ephus Internal triggerOrigin P0.2 goes to PFI9 \u2013 PFI9 is for triggering internal to Ephus\u200b PFI0 of Dev2/USB-6229 (BNC port) is connected to Dev1/PCI-6110 USER2 BNC port.\u200b Dev1/USER2 is connected to Dev1/PFI13\u200b Initial configuration state *.settings for each Ephus window at startup: config/Ephus/init_config Chosen at Ephus start Located in C:/Rig/Ephus 2013b/startup/config/init_config Custom user functions Located in C:/Rig/Ephus 2013b/custom_user_fcns savePulseDetails.m : Save stimulus pulse details to .mat file. This will save the pulse details and traceAcquired time in a mat file using the same path and naming convention as the xsg settings. randPulseFromSetWOrepl.m : update selected pulse to random in list (without replacement) randPulseFromSetWrepl.m : update selected pulse to random in list (with replacement) qcamExternalReset.m : Resets QCam to External automatically to enable loops. Otherwise would need to manually click External off and on. See: Ephus looping testusrfcn.m : for testing user functions ScanImage Machine Data File (startup) Machine_Data_File.m Key configuration values : shutterDaqDevices = {'Dev1'}; % Cell array specifying the DAQ device or RIO devices for each shutter eg {'PXI1Slot3' 'PXI1Slot4'} shutterChannelIDs = {'port0/line7'}; % Cell array specifying the corresponding channel on the device for each shutter eg {'PFI12'} motors(1).controllerType = 'sutter.mpc200'; % If supplied, one of {'sutter.mp285', 'sutter.mpc200', 'thorlabs.mcm3000', 'thorlabs.mcm5000', 'scientifica', 'pi.e665', 'pi.e816', 'npoint.lc40x'}. motors(1).dimensions = 'XYZ'; % Assignment of stage dimensions to SI dimensions. Can be any combination of X,Y,Z, and R. motors(1).comPort = 3; % Integer identifying COM port for controller, if using serial communication motors(1).customArgs = {}; % Additional arguments to stage controller. Some controller require a valid stageType be specified motors(1).invertDim = '+++'; % string with one character for each dimension specifying if the dimension should be inverted. '+' for normal, '-' for inverted motors(1).moveCompleteDelay = 5; % Delay from when stage controller reports move is complete until move is actually considered complete. Allows settling time for motor %% LinScan (LinScanner) deviceNameAcq = 'Dev1'; % string identifying NI DAQ board for PMT channels input deviceNameGalvo = 'Dev1'; % string identifying NI DAQ board for controlling X/Y galvo. leave empty if same as deviceNameAcq shutterIDs = 1; % Array of the shutter IDs that must be opened for linear scan system to operate %Acquisition channelIDs = [0 1 2 3]; % Array of numeric channel IDs for PMT inputs. Leave empty for default channels (AI0...AIN-1) %Scanner control XMirrorChannelID = 0; % The numeric ID of the Analog Output channel to be used to control the X Galvo. YMirrorChannelID = 1; % The numeric ID of the Analog Output channel to be used to control the y Galvo. xGalvoAngularRange = 30; % max range in optical degrees (pk-pk) for x galvo yGalvoAngularRange = 30; % max range in optical degrees (pk-pk) for y galvo voltsPerOpticalDegreeX = 0.333; % galvo conversion factor from optical degrees to volts (negative values invert scan direction) voltsPerOpticalDegreeY = 0.333; % galvo conversion factor from optical degrees to volts (negative values invert scan direction) scanParkAngleX = 7.5; % Numeric [deg]: Optical degrees from center position for X galvo to park at when scanning is inactive scanParkAngleY = 7.5; % Numeric [deg]: Optical degrees from center position for Y galvo to park at when scanning is inactive %Optional: mirror position offset outputs for motion correction deviceNameOffset = ''; % string identifying NI DAQ board that hosts the offset analog outputs XMirrorOffsetChannelID = 0; % numeric ID of the Analog Output channel to be used to control the X Galvo offset. YMirrorOffsetChannelID = 1; % numeric ID of the Analog Output channel to be used to control the y Galvo offset. XMirrorOffsetMaxVoltage = 1; % maximum allowed voltage output for the channel specified in XMirrorOffsetChannelID YMirrorOffsetMaxVoltage = 1; % maximum allowed voltage output for the channel specified in YMirrorOffsetChannelID internalRefClockSrc = ''; User Settings File: working_acqModeArmed.cfg : default Additional configuration settings working_merge_acqModeArmed.cfg : both channels Pulse Train Config PulseTrainPanelInit.m : ran at startup - initiates pulse train UI fig pcPulseTrainTriggerPanel.fig : UI .fig file pcPulseTrainTriggerPanel.m : Pulse train script User function digtrig_stimPulse_train.m : Triggers Ephus stimulus pulse with configurable delay digtrig_stimPulse_train_withCam.m : Version with pupillometry camera support scim5eventTest.m : For testing user functions How the user functions work: The digtrig_stimPulse_train function responds to three ScanImage events. The event name is passed as input to the function and handled via switch/case: acqModeArmed event - Triggered when acquisition starts Creates an NI-DAQ counter output task with configurable delay and pulse width After the delay, initiates a +5V pulse on counter 1 (ctr1) corresponding to PFI13 Signal path: PFI13 \u2192 USER2 \u2192 BNC cable \u2192 NI USB-6229 PFI0 Ephus stimulator and acquirer are configured to trigger on PFI0 (Dev2/USB-6229) The stimDelay and stimWidth parameters are saved to a .mat file matching the .tif filename acqModeDone event - Triggered when acquisition completes normally Clears the NI-DAQ counter output task so it can be reused acqAbort event - Triggered when acquisition is prematurely stopped Aborts and clears the NI-DAQ counter output task for safe reuse Ephus + ScanImage File naming scheme for organized data files Notes Ctr corresponds to counter output channel Ctr0 = PFI12 ; Ctr1 = PFI13 PFI13 on Dev1/PCI-6110 goes to User2 which goes to PFI0 on Dev2/USB-6229 Counter output channels 0/1/2/3 correspond to terminals PFI 12/13/14/15 on the BNC breakouts for NI multifunction boards","title":"Configuration"},{"location":"configuration/#configuration","text":"","title":"Configuration"},{"location":"configuration/#ephus","text":"","title":"Ephus"},{"location":"configuration/#startup-file","text":"ephus_init_matlab2013b_32bit_250kHz_Camera_20250903.m Key configuration values : xsgStartDirectory = 'D:\\Data\\sutter2P\\'; %Acquirer channels (Analog Input) acqChannelNames = {'sound output check', 'Green LED output check'}; % Cell array of descriptive names for analog input acquisition channels to configure, e.g. {'Lick Sensor' 'Nose Poke Sensor'}, acqBoardIDs = [2 2]; % A single number (e.g. 1 for 'Dev1') specifying DAQmx board for /all/ named acquisition channels; or, an array of numbers of length equal to 'acqChannelNames' (e.g. [1 1 1 2 2] indicating 'Dev1' for first 3 channels, 'Dev2' for last 2 channels) identifying DAQmx board on which each of the named acquisition channels appears. acqChannelIDs = [16 17]; % Array of numbers, of length equal to 'acqChannelNames', identifying DAQmx channel number (e.g. 1 for AI1) for each of the named acquisition channels (e.g. [0 1 2 0 1] indicating AI0-2 for first 3 channels and AI0-1 for last 2 channels, for case of multiple boards). %Stimulator channels (Analog Output) stimChannelNames = {'Sound output', 'Blue LED output', 'Camera trigger', 'Green LED output'}; % Cell array of descriptive names for analog output stimulus channels to configure, e.g. {'Whisker Stimulator' 'Position Encoder'}, stimBoardIDs = [2 2 2 2]; % A single number (e.g. 1 for 'Dev1') specifying DAQmx board for /all/ named analog stimulus channels; or, an array of numbers of length equal to 'stimChannelNames' (e.g. [1 1 1 2 2] indicating 'Dev1' for first 3 channels, 'Dev2' for last 2 channels) identifying DAQmx board on which each of the named analog stimulus channels appears. stimChannelIDs = [1 2 3 0]; % Array of numbers, of length equal to 'stimChannelNames', identifying DAQmx channel number (e.g. 1 for AI1) for each of the named analog stimulus channels (e.g. [0 1 2 0 1] indicating AI0-2 for first 3 channels and AI0-1 for last 2 channels, for case of multiple boards). initialSampleRate = 250000; %(REQUIRED) Initial rate, in Hz, to use for all analog and digital input/output channels configured for use in Ephus triggerOrigin = '/dev2/port0/line2'; %(REQUIRED) Full DAQmx specification of single digital line on /one/ board (e.g. '/dev1/port0/line0') used as the Ephus default trigger pulse to synchronize the one or more boards. triggerDestinations = {'PFI9','PFI0'}; %PFIO is external trigger-CTA %(REQUIRED) Cell array of one or more DAQmx PFI terminal names configured as the choice of PFI terminals on which Ephus must receive a trigger input signal, on /all/ of the DAQmx boards configured for use by Ephus. sampleClockOrigin = '/dev2/ctr0'; %this is ctr0 is PFI12, ctr1 is PFI13 CTA % Full DAQmx specification of single counter output channel on /one/ board (e.g. '/dev1/ctr0') on which the sample clock generated by Ephus appears. Ephus employs the default DAQmx routing of counter output channels to PFI output terminals (PFI12 for CTR0, PFI13 for CTR1; refer to DAQmx documentation for further information), Full DAQmx specification of counter output channel on /one/ board (e.g. '/dev1/ctr0') on which the sample clock is generated. sampleClockDestination = 'PFI10'; % A DAQmx PFI terminal name (e.g. 'PFI1') on which sample clock is input on /all/ of the boards used by Ephus Internal triggerOrigin P0.2 goes to PFI9 \u2013 PFI9 is for triggering internal to Ephus\u200b PFI0 of Dev2/USB-6229 (BNC port) is connected to Dev1/PCI-6110 USER2 BNC port.\u200b Dev1/USER2 is connected to Dev1/PFI13\u200b","title":"Startup file"},{"location":"configuration/#initial-configuration-state","text":"*.settings for each Ephus window at startup: config/Ephus/init_config Chosen at Ephus start Located in C:/Rig/Ephus 2013b/startup/config/init_config","title":"Initial configuration state"},{"location":"configuration/#custom-user-functions","text":"Located in C:/Rig/Ephus 2013b/custom_user_fcns savePulseDetails.m : Save stimulus pulse details to .mat file. This will save the pulse details and traceAcquired time in a mat file using the same path and naming convention as the xsg settings. randPulseFromSetWOrepl.m : update selected pulse to random in list (without replacement) randPulseFromSetWrepl.m : update selected pulse to random in list (with replacement) qcamExternalReset.m : Resets QCam to External automatically to enable loops. Otherwise would need to manually click External off and on. See: Ephus looping testusrfcn.m : for testing user functions","title":"Custom user functions"},{"location":"configuration/#scanimage","text":"","title":"ScanImage"},{"location":"configuration/#machine-data-file-startup","text":"Machine_Data_File.m Key configuration values : shutterDaqDevices = {'Dev1'}; % Cell array specifying the DAQ device or RIO devices for each shutter eg {'PXI1Slot3' 'PXI1Slot4'} shutterChannelIDs = {'port0/line7'}; % Cell array specifying the corresponding channel on the device for each shutter eg {'PFI12'} motors(1).controllerType = 'sutter.mpc200'; % If supplied, one of {'sutter.mp285', 'sutter.mpc200', 'thorlabs.mcm3000', 'thorlabs.mcm5000', 'scientifica', 'pi.e665', 'pi.e816', 'npoint.lc40x'}. motors(1).dimensions = 'XYZ'; % Assignment of stage dimensions to SI dimensions. Can be any combination of X,Y,Z, and R. motors(1).comPort = 3; % Integer identifying COM port for controller, if using serial communication motors(1).customArgs = {}; % Additional arguments to stage controller. Some controller require a valid stageType be specified motors(1).invertDim = '+++'; % string with one character for each dimension specifying if the dimension should be inverted. '+' for normal, '-' for inverted motors(1).moveCompleteDelay = 5; % Delay from when stage controller reports move is complete until move is actually considered complete. Allows settling time for motor %% LinScan (LinScanner) deviceNameAcq = 'Dev1'; % string identifying NI DAQ board for PMT channels input deviceNameGalvo = 'Dev1'; % string identifying NI DAQ board for controlling X/Y galvo. leave empty if same as deviceNameAcq shutterIDs = 1; % Array of the shutter IDs that must be opened for linear scan system to operate %Acquisition channelIDs = [0 1 2 3]; % Array of numeric channel IDs for PMT inputs. Leave empty for default channels (AI0...AIN-1) %Scanner control XMirrorChannelID = 0; % The numeric ID of the Analog Output channel to be used to control the X Galvo. YMirrorChannelID = 1; % The numeric ID of the Analog Output channel to be used to control the y Galvo. xGalvoAngularRange = 30; % max range in optical degrees (pk-pk) for x galvo yGalvoAngularRange = 30; % max range in optical degrees (pk-pk) for y galvo voltsPerOpticalDegreeX = 0.333; % galvo conversion factor from optical degrees to volts (negative values invert scan direction) voltsPerOpticalDegreeY = 0.333; % galvo conversion factor from optical degrees to volts (negative values invert scan direction) scanParkAngleX = 7.5; % Numeric [deg]: Optical degrees from center position for X galvo to park at when scanning is inactive scanParkAngleY = 7.5; % Numeric [deg]: Optical degrees from center position for Y galvo to park at when scanning is inactive %Optional: mirror position offset outputs for motion correction deviceNameOffset = ''; % string identifying NI DAQ board that hosts the offset analog outputs XMirrorOffsetChannelID = 0; % numeric ID of the Analog Output channel to be used to control the X Galvo offset. YMirrorOffsetChannelID = 1; % numeric ID of the Analog Output channel to be used to control the y Galvo offset. XMirrorOffsetMaxVoltage = 1; % maximum allowed voltage output for the channel specified in XMirrorOffsetChannelID YMirrorOffsetMaxVoltage = 1; % maximum allowed voltage output for the channel specified in YMirrorOffsetChannelID internalRefClockSrc = '';","title":"Machine Data File (startup)"},{"location":"configuration/#user-settings-file","text":"working_acqModeArmed.cfg : default","title":"User Settings File:"},{"location":"configuration/#additional-configuration-settings","text":"working_merge_acqModeArmed.cfg : both channels","title":"Additional configuration settings"},{"location":"configuration/#pulse-train-config","text":"PulseTrainPanelInit.m : ran at startup - initiates pulse train UI fig pcPulseTrainTriggerPanel.fig : UI .fig file pcPulseTrainTriggerPanel.m : Pulse train script","title":"Pulse Train Config"},{"location":"configuration/#user-function","text":"digtrig_stimPulse_train.m : Triggers Ephus stimulus pulse with configurable delay digtrig_stimPulse_train_withCam.m : Version with pupillometry camera support scim5eventTest.m : For testing user functions How the user functions work: The digtrig_stimPulse_train function responds to three ScanImage events. The event name is passed as input to the function and handled via switch/case: acqModeArmed event - Triggered when acquisition starts Creates an NI-DAQ counter output task with configurable delay and pulse width After the delay, initiates a +5V pulse on counter 1 (ctr1) corresponding to PFI13 Signal path: PFI13 \u2192 USER2 \u2192 BNC cable \u2192 NI USB-6229 PFI0 Ephus stimulator and acquirer are configured to trigger on PFI0 (Dev2/USB-6229) The stimDelay and stimWidth parameters are saved to a .mat file matching the .tif filename acqModeDone event - Triggered when acquisition completes normally Clears the NI-DAQ counter output task so it can be reused acqAbort event - Triggered when acquisition is prematurely stopped Aborts and clears the NI-DAQ counter output task for safe reuse","title":"User function"},{"location":"configuration/#ephus-scanimage","text":"File naming scheme for organized data files","title":"Ephus + ScanImage"},{"location":"configuration/#notes","text":"Ctr corresponds to counter output channel Ctr0 = PFI12 ; Ctr1 = PFI13 PFI13 on Dev1/PCI-6110 goes to User2 which goes to PFI0 on Dev2/USB-6229 Counter output channels 0/1/2/3 correspond to terminals PFI 12/13/14/15 on the BNC breakouts for NI multifunction boards","title":"Notes"},{"location":"drivers/","text":"Drivers required to interface with recording hardware Imaging NI-DAQmx : interface for the USB-6229 (Ephus) and NI PCI-6110 (ScanImage) DAQs v15.5.0 : NIDAQ1550f1.zip\u200b QCam driver for widefield camera: QCamInstaller-2-0-13-1-64bit.zip Sutter CDM Controller Driver: SI_CDM_v2_12_36.zip Installation guide Driver for laser power adjustment ( Thorlabs Kinesis controller of PRM1Z8) Thorlabs_Kinesis_Setup_25822_x64.exe Computer Driver sources: Dell Precision T5810 Drivers & Downloads DellSupportAssistinstaller.exe See: computer_setup.md ( first install Dell Support Assist to install relevant drivers ) Audio_Driver_DDG39_WN32_6.0.1.6111_A06_01.EXE Chipset_Driver_8W65V_1.0.0.1024_A00_ZPE.exe Chipset_Driver_YV36W_WN32_10.1.2.10_A01.EXE Dell-Security-Advisory-Update-DSA-2020-059_1GWG9_WIN64_1.0.0.0_A00_03.EXE","title":"Drivers"},{"location":"drivers/#drivers","text":"required to interface with recording hardware","title":"Drivers"},{"location":"drivers/#imaging","text":"NI-DAQmx : interface for the USB-6229 (Ephus) and NI PCI-6110 (ScanImage) DAQs v15.5.0 : NIDAQ1550f1.zip\u200b QCam driver for widefield camera: QCamInstaller-2-0-13-1-64bit.zip Sutter CDM Controller Driver: SI_CDM_v2_12_36.zip Installation guide Driver for laser power adjustment ( Thorlabs Kinesis controller of PRM1Z8) Thorlabs_Kinesis_Setup_25822_x64.exe","title":"Imaging"},{"location":"drivers/#computer","text":"Driver sources: Dell Precision T5810 Drivers & Downloads DellSupportAssistinstaller.exe See: computer_setup.md ( first install Dell Support Assist to install relevant drivers ) Audio_Driver_DDG39_WN32_6.0.1.6111_A06_01.EXE Chipset_Driver_8W65V_1.0.0.1024_A00_ZPE.exe Chipset_Driver_YV36W_WN32_10.1.2.10_A01.EXE Dell-Security-Advisory-Update-DSA-2020-059_1GWG9_WIN64_1.0.0.0_A00_03.EXE","title":"Computer"},{"location":"hardware/","text":"Hardware Sutter 2P rig for in vivo 2PCI (2 Photon Calcium Imaging) Computer Dell Precision Tower 5810 Intel Xeon CPU E5-1630 @ 3.70 GHz 32.0 GB RAM NVIDIA NVS 310 Graphics Microscope Sutter MOM (Moveable Objective Microscope) Objective moves rather than the stage (stage moves on Scientifica rig) dichroic splitter (Di02-R561, Semrock) green emission filter (FF03-525/50, Semrock) objective: 40 0.8 NA objective (Olympus) DAQs NI USB-6229 (ID: Dev2 ) Ephus acquire / sound stimulation NI PCI-6110 ( BNC-2090A breakout ) (ID: Dev1 ) ScanImage 2P: Galvo Mirrors (Channels: AO0 , AO1 )\u200b PMT (Channels: AI8 , AI9 ) Shutter (Channels: USER 1 ) Trigger output to trigger Ephus sound delivery (Channels: USER 2 ) Path: PFI13 (Digital I/O PFI terminal block) \u21d2 USER 2 \u21d2 BNC cable \u21d2 NI USB 6229 \u21d2 PFI0/P1.0\u200b \u21d2 PFI10 (terminal block) PMT Controller: Sutter PS-2LV Hamamatsu H10770PA-40 Shutter Controller: ThorLabs SC10 Shutter Controller Galvo / Scan controller Sutter MDR MOM Scan Drive Controller Galvo / Galvo mirrors for laser scanning Laser MaiTai HP, Newport Speaker and Speaker controller freefield speaker (ES1, Tucker Davis) ED1 speaker driver (Tucker Davis) Micromanipulator Sutter ROE-200 Power Intensity Controller ThorLabs Kinesis Motor Controller KDC101 Rotates PRM1Z8 to adjust laser intensity entering Sutter enclosure Temperature control FHC DC Temperature controller with heat pad and rectal thermister","title":"Hardware"},{"location":"hardware/#hardware","text":"Sutter 2P rig for in vivo 2PCI (2 Photon Calcium Imaging)","title":"Hardware"},{"location":"hardware/#computer","text":"Dell Precision Tower 5810 Intel Xeon CPU E5-1630 @ 3.70 GHz 32.0 GB RAM NVIDIA NVS 310 Graphics","title":"Computer"},{"location":"hardware/#microscope","text":"Sutter MOM (Moveable Objective Microscope) Objective moves rather than the stage (stage moves on Scientifica rig) dichroic splitter (Di02-R561, Semrock) green emission filter (FF03-525/50, Semrock) objective: 40 0.8 NA objective (Olympus)","title":"Microscope"},{"location":"hardware/#daqs","text":"NI USB-6229 (ID: Dev2 ) Ephus acquire / sound stimulation NI PCI-6110 ( BNC-2090A breakout ) (ID: Dev1 ) ScanImage 2P: Galvo Mirrors (Channels: AO0 , AO1 )\u200b PMT (Channels: AI8 , AI9 ) Shutter (Channels: USER 1 ) Trigger output to trigger Ephus sound delivery (Channels: USER 2 ) Path: PFI13 (Digital I/O PFI terminal block) \u21d2 USER 2 \u21d2 BNC cable \u21d2 NI USB 6229 \u21d2 PFI0/P1.0\u200b \u21d2 PFI10 (terminal block)","title":"DAQs"},{"location":"hardware/#pmt","text":"Controller: Sutter PS-2LV Hamamatsu H10770PA-40","title":"PMT"},{"location":"hardware/#shutter","text":"Controller: ThorLabs SC10 Shutter Controller","title":"Shutter"},{"location":"hardware/#galvo-scan-controller","text":"Sutter MDR MOM Scan Drive Controller Galvo / Galvo mirrors for laser scanning","title":"Galvo / Scan controller"},{"location":"hardware/#laser","text":"MaiTai HP, Newport","title":"Laser"},{"location":"hardware/#speaker-and-speaker-controller","text":"freefield speaker (ES1, Tucker Davis) ED1 speaker driver (Tucker Davis)","title":"Speaker and Speaker controller"},{"location":"hardware/#micromanipulator","text":"Sutter ROE-200","title":"Micromanipulator"},{"location":"hardware/#power-intensity-controller","text":"ThorLabs Kinesis Motor Controller KDC101 Rotates PRM1Z8 to adjust laser intensity entering Sutter enclosure","title":"Power Intensity Controller"},{"location":"hardware/#temperature-control","text":"FHC DC Temperature controller with heat pad and rectal thermister","title":"Temperature control"},{"location":"operation/","text":"Operation Ephus Ephus should be configured to save the xsg file . This can be loaded as a mat file that contains the state of Ephus during the acquisition. It contains a structure called header which contains the pulse info and gain along with the actual stimulus trace\u200b Configuration hotswitches Save configuration settings for program windows regarding recording and stimulation settings See: Programs \u2192 hotswitch Programs \u2192 hotswitch: hs_config Located in C:/Rig/Ephus 2013b/hotswitches Looping Programs \u2192 LoopGui Set number of iterations Set interval time between iterations Ensure stimulator and acquirer are set to external and use PFI9 for triggering ScanImage 145X145 mm images at 256X256 pixel resolution at an effective frame rate of 5 Hz Looping (cycles) Cycles allow multiple iterations with defined delays between acquisitions. Cycles are saved in: C:\\Rig\\Scanimage5-3\\cycles Setup procedure: View \u2192 Cycle Controls to open cycle configuration (CYCLE-MODE CONTROLS) Check Cycle mode on Load existing cycle or save new cycle configuration Configuring iterations: Multiple iterations can exist for each cycle, with each iteration preceded by a defined Iteration Delay . Example: 1 cycle with 4 iterations, each with 120s delay Click >> for cycle iteration data Cycles done: displays X of 1 Add 4 iterations Enter 131 in Iteration delay field and press Enter Calculation: Frame collection time (~11s for 50 frames at 5 Hz) + desired delay (120s) = 131s total Check Restore original cfg Check Auto-reset iteration/count Click CYCLE to begin cycle Note: There is a timing delay of ~97-99ms (occasionally up to 700ms) between the ScanImage acquisition start message (e.g., \"Starting '1 x zoom 5 Hz' at 6/13/2018 12:33:16.136\") and the acquisitionStarted timestamp in the digtrig_stim user function.","title":"Operation"},{"location":"operation/#operation","text":"","title":"Operation"},{"location":"operation/#ephus","text":"Ephus should be configured to save the xsg file . This can be loaded as a mat file that contains the state of Ephus during the acquisition. It contains a structure called header which contains the pulse info and gain along with the actual stimulus trace\u200b","title":"Ephus"},{"location":"operation/#configuration-hotswitches","text":"Save configuration settings for program windows regarding recording and stimulation settings See: Programs \u2192 hotswitch Programs \u2192 hotswitch: hs_config Located in C:/Rig/Ephus 2013b/hotswitches","title":"Configuration hotswitches"},{"location":"operation/#looping","text":"Programs \u2192 LoopGui Set number of iterations Set interval time between iterations Ensure stimulator and acquirer are set to external and use PFI9 for triggering","title":"Looping"},{"location":"operation/#scanimage","text":"145X145 mm images at 256X256 pixel resolution at an effective frame rate of 5 Hz","title":"ScanImage"},{"location":"operation/#looping-cycles","text":"Cycles allow multiple iterations with defined delays between acquisitions. Cycles are saved in: C:\\Rig\\Scanimage5-3\\cycles Setup procedure: View \u2192 Cycle Controls to open cycle configuration (CYCLE-MODE CONTROLS) Check Cycle mode on Load existing cycle or save new cycle configuration Configuring iterations: Multiple iterations can exist for each cycle, with each iteration preceded by a defined Iteration Delay . Example: 1 cycle with 4 iterations, each with 120s delay Click >> for cycle iteration data Cycles done: displays X of 1 Add 4 iterations Enter 131 in Iteration delay field and press Enter Calculation: Frame collection time (~11s for 50 frames at 5 Hz) + desired delay (120s) = 131s total Check Restore original cfg Check Auto-reset iteration/count Click CYCLE to begin cycle Note: There is a timing delay of ~97-99ms (occasionally up to 700ms) between the ScanImage acquisition start message (e.g., \"Starting '1 x zoom 5 Hz' at 6/13/2018 12:33:16.136\") and the acquisitionStarted timestamp in the digtrig_stim user function.","title":"Looping (cycles)"},{"location":"pupillometry/","text":"Camera uEye UI145xLE-M is equivalent to DCC1545M Dev2/USB-6229 used for camera control / counter output","title":"Pupillometry"},{"location":"pupillometry/#camera","text":"uEye UI145xLE-M is equivalent to DCC1545M Dev2/USB-6229 used for camera control / counter output","title":"Camera"},{"location":"software/","text":"Software OS WINDOWS 10 (21H2 x64) Network Globus (for data backup): globusconnectpersonal-latest.exe Global Protect (for connecting to PittNet): WIN-GlobalProtect64-6.2.7.msi Matlab Downloads For Ephus 2.1.0: Matlab 2013b 32bit For ScanImage 5.3.1 / 2017: Matlab 2015b x64 Ephus: Use: Widefield imaging and sound stimulus delivery Version: 2.1.0 ScanImage Use: 2P Version: 5.3.1 / 2017 Docs Docs also at: Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC \u2192 scanimage_5-3-1_2017_docs.zip )","title":"Software"},{"location":"software/#software","text":"","title":"Software"},{"location":"software/#os","text":"WINDOWS 10 (21H2 x64)","title":"OS"},{"location":"software/#network","text":"Globus (for data backup): globusconnectpersonal-latest.exe Global Protect (for connecting to PittNet): WIN-GlobalProtect64-6.2.7.msi","title":"Network"},{"location":"software/#matlab","text":"Downloads For Ephus 2.1.0: Matlab 2013b 32bit For ScanImage 5.3.1 / 2017: Matlab 2015b x64","title":"Matlab"},{"location":"software/#ephus","text":"Use: Widefield imaging and sound stimulus delivery Version: 2.1.0","title":"Ephus:"},{"location":"software/#scanimage","text":"Use: 2P Version: 5.3.1 / 2017 Docs Docs also at: Sharepoint (Tzounopoulos Lab (2024) \u2192 Documents \u2192 data \u2192 PAC \u2192 sutter_2P_rigConfig_PAC \u2192 scanimage_5-3-1_2017_docs.zip )","title":"ScanImage"}]}